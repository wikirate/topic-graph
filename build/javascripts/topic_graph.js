(function(){var e=[].indexOf||function(e){for(var t=0,o=this.length;t<o;t++)if(t in this&&this[t]===e)return t;return-1};window.TopicGraph=function(){function t(e,t,o){var n,i,s,r,a,c,d,h,p,l,u,f,m,g,_,w,b,y,v,k;for(this.container=o,this.topic_ids={},this.topic_connections={},this.nodes=null,this.selected_node=null,this.edges=null,this.data={},this.network=null,this.topic_count=0,this.topic_connection_count=0,this.options={font_size:20,node_size:1,edge_size:1,simple_weight:!1,edge_threshold:2,node_threshold:2,colorful:!1},this.example_topic={id:45466,name:"Accident",type:"Topic",url:"https://wikirate.org/Accident.json",content:"",bookmarkers:0,metrics:6,projects:0},this.example_metric={id:538693,name:"2020WoB+Women on Board",type:"Metric",url:"https://wikirate.org/2020WoB+Women_on_Board.json",designer:"2020WoB",title:"Women on Board",question:"What percentage of people on the company's board of directors are women?",metric_type:"Researched",about:"<p><span>2020 Women on Boards conducts research studies about the gender composition of the boards of directors of US companies.</span></p>",methodology:'<p>To search for a company listed on the 2020 Women on Boards directory, check the database here: <a href="https://www.2020wob.com/company-directory">https://www.2020wob.com/company-directory</a>. See also data in the 2014 report <a href="http://www.2020wob.com/sites/default/files/2020GDI-2014Report.pdf">here</a>.</p>',value_type:"Number",value_options:["Unknown"],report_type:"Data Breach Report",research_policy:"Designer Assessed",unit:"%",range:null,hybrid:"no",topics:["Employee","Gender equality"],scores:["2020WoB+Women on Board+Mariana","2020WoB+Women on Board+Alex H","2020WoB+Women on Board+Elizabeth Potter"],answers:3571,bookmarkers:6,projects:4,answers_url:"https://wikirate.org/2020WoB+Women_on_Board+Answer.json"},this.topics=t.items,this.topic_count=this.topics.length,w=this.topics,h=0,u=w.length;h<u;h++)d=w[h],this.topic_ids[d.name]=d.id;for(v=this,b=e.items,p=0,f=b.length;p<f;p++)if(d=b[p],d.topics.length>1)for(c=d.topics.map(function(e){return v.topic_ids[e]}).sort(),k=1/(d.topics.length-1),s=l=0,m=c.length;l<m;s=++l)for(r=c[s],y=c.slice(s+1),_=0,g=y.length;_<g;_++)a=y[_],null==(n=this.topic_connections)[r]&&(n[r]={}),null==(i=this.topic_connections[r])[a]&&(i[a]={count:0,score:0}),0===this.topic_connections[r][a].count&&(this.topic_connection_count+=1),this.topic_connections[r][a].count+=1,this.topic_connections[r][a].score+=k}return t.prototype.showEdge=function(e){return this.options.simple_weight?e.count>=this.options.edge_threshold:e.score>=this.options.edge_threshold},t.prototype.showNode=function(e){return e.metrics>=this.options.node_threshold},t.prototype.updateEdges=function(){var e,t,o,n,i,s;this.edges=new vis.DataSet([]),i=this.topic_connections,s=[];for(t in i)n=i[t],s.push(function(){var i;i=[];for(o in n)e=n[o],this.showEdge(this.topic_connections[t][o])?i.push(this.edges.add({from:parseInt(t),to:parseInt(o),value:e.count*this.options.edge_size})):i.push(void 0);return i}.call(this));return s},t.prototype.updateNodes=function(){var e,t,o,n,i,s;for(this.nodes=new vis.DataSet([]),n=this.topics,i=[],t=0,o=n.length;t<o;t++)s=n[t],this.showNode(s)?(e=function(){switch(!1){case!this.options.colorful:return s.id;case 0!==s.name.indexOf("GRI"):return 2;case 0!==s.name.indexOf("SDG"):return 3;case 0!==s.name.indexOf("G4"):return 4;default:return 1}}.call(this),i.push(this.nodes.add({id:s.id,label:s.name,label_bak:s.name,value:s.metrics*this.options.node_size,group:e}))):i.push(void 0);return i},t.prototype.loadConfig=function(e){return this.options=e},t.prototype.render=function(){var t,o,n;return this.data={nodes:this.nodes,edges:this.edges},t=this.data,o={nodes:{shape:"dot",font:{size:this.options.font_size},scaling:{min:10,max:70,label:{enabled:!1,min:10,max:50}}},edges:{scaling:{min:1,max:30,label:{enabled:!0,min:20,max:50}}},interaction:{hover:!0},physics:{forceAtlas2Based:{gravitationalConstant:-26,centralGravity:.005,springLength:230,springConstant:.18},maxVelocity:146,solver:"forceAtlas2Based",timestep:.35,stabilization:{iterations:150}}},n=this,this.network=new vis.Network(this.container,t,o),this.network.on("click",function(t){var o;return t.nodes.length<1||this.selected_node===t.nodes[0]?(this.selected_node=null,n.nodes.update(n.nodes.get({fields:["id","label_bak"]}).map(function(e){return{id:e.id,label:e.label_bak}})),void n.edges.update(n.edges.getIds().map(function(e){return{id:e,hidden:!1}}))):(this.selected_node=t.nodes[0],o=t.nodes,n.edges.get({filter:function(o){var n;return n=o.id,e.call(t.edges,n)>=0}}).forEach(function(e){return o.push(e.from),o.push(e.to)}),n.nodes.update(n.nodes.get({fields:["id","label_bak"]}).map(function(t){var n;return{id:t.id,label:(n=t.id,e.call(o,n)>=0?t.label_bak:"")}})),n.edges.update(n.edges.getIds().map(function(o){return{id:o,hidden:e.call(t.edges,o)<0}})),console.log("click event, getNodeAt returns: "+this.getNodeAt(t.pointer.DOM)))})},t}()}).call(this);