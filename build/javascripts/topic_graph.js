(function(){var e,t,o=[].indexOf||function(e){for(var t=0,o=this.length;t<o;t++)if(t in this&&this[t]===e)return t;return-1};e={simple:1,topic_count:2,bookmarks:3},t={metrics:1,bookmarks:2},window.TopicGraph=function(){function n(o,n,s){var i,r,c,a,d,h,l,p,u,m,f,_,g,b,k,w,y,v,B,W,z;for(this.container=s,this.topic_ids={},this.topic_connections={},this.nodes=null,this.selected_node=null,this.edges=null,this.data={},this.network=null,this.topic_count=0,this.topic_connection_count=0,this.options={font_size:20,node_size:1,edge_size:1,edge_formula:e.topic_count,node_formula:t.metrics,edge_threshold:2,node_threshold:2,colorful:!1},this.vis_config={nodes:{shape:"dot",font:{size:this.options.font_size},scaling:{min:10,max:70,label:{enabled:!1,min:10,max:50}}},edges:{scaling:{min:1,max:20,label:{enabled:!0,min:20,max:50}}},interaction:{hover:!0},physics:{forceAtlas2Based:{gravitationalConstant:-26,centralGravity:.005,springLength:230,springConstant:.18},maxVelocity:146,solver:"forceAtlas2Based",timestep:.35,stabilization:{iterations:150}}},this.example_topic={id:45466,name:"Accident",type:"Topic",url:"https://wikirate.org/Accident.json",content:"",bookmarkers:0,metrics:6,projects:0},this.example_metric={id:538693,name:"2020WoB+Women on Board",type:"Metric",url:"https://wikirate.org/2020WoB+Women_on_Board.json",designer:"2020WoB",title:"Women on Board",question:"What percentage of people on the company's board of directors are women?",metric_type:"Researched",about:"<p><span>2020 Women on Boards conducts research studies about the gender composition of the boards of directors of US companies.</span></p>",methodology:'<p>To search for a company listed on the 2020 Women on Boards directory, check the database here: <a href="https://www.2020wob.com/company-directory">https://www.2020wob.com/company-directory</a>. See also data in the 2014 report <a href="http://www.2020wob.com/sites/default/files/2020GDI-2014Report.pdf">here</a>.</p>',value_type:"Number",value_options:["Unknown"],report_type:"Data Breach Report",research_policy:"Designer Assessed",unit:"%",range:null,hybrid:"no",topics:["Employee","Gender equality"],scores:["2020WoB+Women on Board+Mariana","2020WoB+Women on Board+Alex H","2020WoB+Women on Board+Elizabeth Potter"],answers:3571,bookmarkers:6,projects:4,answers_url:"https://wikirate.org/2020WoB+Women_on_Board+Answer.json"},this.topics=n.items,this.topic_count=this.topics.length,y=this.topics,u=0,_=y.length;u<_;u++)p=y[u],this.topic_ids[p.name]=p.id;for(W=this,v=o.items,m=0,g=v.length;m<g;m++)if(p=v[m],null!=p.topics&&p.topics.length>1)for(l=p.topics.map(function(e){return W.topic_ids[e]}).sort(),z=1/(p.topics.length-1),c=p.bookmarkers,a=f=0,b=l.length;f<b;a=++f)for(d=l[a],B=l.slice(a+1),w=0,k=B.length;w<k;w++)h=B[w],null==(i=this.topic_connections)[d]&&(i[d]={}),null==(r=this.topic_connections[d])[h]&&(r[h]={count:0,topic_count_score:0,bookmark_score:0,title:"Connecting Metrics:"}),0===this.topic_connections[d][h].count&&(this.topic_connection_count+=1),this.topic_connections[d][h].count+=1,this.topic_connections[d][h].topic_count_score+=z,this.topic_connections[d][h].bookmark_score+=c,this.topic_connections[d][h].title+="<br>"+p.name}return n.prototype.showEdge=function(t){return this.options.edge_formula===e.simple?t.count>=this.options.edge_threshold:this.options.edge_formula===e.topic_count?t.topic_count_score>=this.options.edge_threshold:t.bookmark_score>=this.options.edge_threshold},n.prototype.showNode=function(e){return this.options.node_formula===t.bookmarks?e.bookmarkers>=this.options.node_threshold:e.metrics>=this.options.node_threshold},n.prototype.setFontSize=function(e){var t,o;return this.options.font_size=e,null==(t=this.vis_config).nodes&&(t.nodes={}),null==(o=this.vis_config.nodes).font&&(o.font={}),this.vis_config.nodes.font.size=e},n.prototype.updateEdges=function(){var e,t,o,n,s,i;this.edges=new vis.DataSet([]),s=this.topic_connections,i=[];for(t in s)n=s[t],i.push(function(){var s;s=[];for(o in n)e=n[o],this.showEdge(this.topic_connections[t][o])?s.push(this.edges.add({from:parseInt(t),to:parseInt(o),value:e.count*this.options.edge_size,metrics:e.title})):s.push(void 0);return s}.call(this));return i},n.prototype.updateNodes=function(){var e,t,o,n,s,i,r;for(this.nodes=new vis.DataSet([]),n=this.topics,s=[],t=0,o=n.length;t<o;t++)i=n[t],this.showNode(i)?(e=function(){switch(!1){case!this.options.colorful:return i.id;case 0!==i.name.indexOf("GRI"):return 2;case 0!==i.name.indexOf("SDG"):return 3;case 0!==i.name.indexOf("G4"):return 4;default:return 1}}.call(this),r=this.options.node_formula_bookmark?i.bookmarkers:i.metrics,s.push(this.nodes.add({id:i.id,label:i.name,label_bak:i.name,value:r*this.options.node_size,group:e}))):s.push(void 0);return s},n.prototype.loadConfig=function(e){return this.options=e,this.setFontSize(e.font_size)},n.prototype.getVisConfig=function(){return jsyaml.safeDump(this.vis_config)},n.prototype.setVisConfig=function(e){return this.vis_config=jsyaml.safeLoad(e),this.network.setOptions(this.vis_config)},n.prototype.showLabelsFor=function(e){return this.nodes.update(this.nodes.get({fields:["id","label_bak"]}).map(function(t){var n;return{id:t.id,label:(n=t.id,o.call(e,n)>=0?t.label_bak:"")}}))},n.prototype.selectNode=function(e,t){var n;return this.selected_node=e,n=this.network.getConnectedNodes(this.selected_node),this.showLabelsFor(n),this.edges.update(this.edges.getIds().map(function(e){return{id:e,hidden:o.call(t,e)<0}}))},n.prototype.selectEdge=function(e){return $("#mymodal .modal-body > p").html(e.metrics),$("#mymodal").show()},n.prototype.reset=function(){return this.selected_node=null,this.nodes.update(this.nodes.get({fields:["id","label_bak"]}).map(function(e){return{id:e.id,label:e.label_bak}})),this.edges.update(this.edges.getIds().map(function(e){return{id:e,hidden:!1}}))},n.prototype.render=function(){var e;return this.data={nodes:this.nodes,edges:this.edges},this.network=new vis.Network(this.container,this.data,this.vis_config),e=this,this.network.on("hoverNode",function(t){var o;return o=e.nodes.get(t.node),o.label=o.label_bak,e.nodes.update(o),o}),this.network.on("doubleClick",function(t){var o,n,s,i,r,c;for(c=t.nodes[0],n=e.network.getConnectedNodes(c),o=[],s=0,i=n.length;s<i;s++)r=n[s],o=o.concat(e.network.getConnectedNodes(r));return e.showLabelsFor(o)}),this.network.on("click",function(t){return t.nodes.length>0?this.selected_node===t.nodes[0]?e.reset():e.selectNode(t.nodes[0],t.edges):t.edges.length>0?e.selectEdge(e.edges.get(t.edges[0])):e.reset()})},n}()}).call(this);