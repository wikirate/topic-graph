(function(){var o,e,n=[].indexOf||function(t){for(var o=0,e=this.length;o<e;o++)if(o in this&&this[o]===t)return o;return-1};o={simple:1,topic_count:2,bookmarks:3},e={metrics:1,bookmarks:2},window.TopicGraph=function(){function t(t,o,e,n){var s,i,r,c,a,d,h,l,p,u,f,m,_,g,k,b,w,y,v,B,W;for(this.container=e,this.topic_ids={},this.topic_connections={},this.nodes=null,this.selected_node=null,this.edges=null,this.data={},this.network=null,this.topic_count=0,this.topic_connection_count=0,this.options=n,this.vis_config={nodes:{shape:"dot",font:{size:this.options.font_size},scaling:{min:10,max:70,label:{enabled:!1,min:10,max:50}}},edges:{scaling:{min:1,max:20,label:{enabled:!0,min:20,max:50}}},interaction:{hover:!0},physics:{forceAtlas2Based:{gravitationalConstant:-26,centralGravity:.005,springLength:230,springConstant:.18},maxVelocity:146,solver:"forceAtlas2Based",timestep:.35,stabilization:{iterations:150}}},this.example_topic={id:45466,name:"Accident",type:"Topic",url:"https://wikirate.org/Accident.json",content:"",bookmarkers:0,metrics:6,projects:0},this.example_metric={id:538693,name:"2020WoB+Women on Board",type:"Metric",url:"https://wikirate.org/2020WoB+Women_on_Board.json",designer:"2020WoB",title:"Women on Board",question:"What percentage of people on the company's board of directors are women?",metric_type:"Researched",about:"<p><span>2020 Women on Boards conducts research studies about the gender composition of the boards of directors of US companies.</span></p>",methodology:'<p>To search for a company listed on the 2020 Women on Boards directory, check the database here: <a href="https://www.2020wob.com/company-directory">https://www.2020wob.com/company-directory</a>. See also data in the 2014 report <a href="http://www.2020wob.com/sites/default/files/2020GDI-2014Report.pdf">here</a>.</p>',value_type:"Number",value_options:["Unknown"],report_type:"Data Breach Report",research_policy:"Designer Assessed",unit:"%",range:null,hybrid:"no",topics:["Employee","Gender equality"],scores:["2020WoB+Women on Board+Mariana","2020WoB+Women on Board+Alex H","2020WoB+Women on Board+Elizabeth Potter"],answers:3571,bookmarkers:6,projects:4,answers_url:"https://wikirate.org/2020WoB+Women_on_Board+Answer.json"},this.family_colors={Social:1,Governance:2,Environment:3},this.topics=o.items,this.topic_count=this.topics.length,p=0,m=(w=this.topics).length;p<m;p++)l=w[p],this.topic_ids[l.name]=l.id;for(B=this,u=0,_=(y=t.items).length;u<_;u++)if(null!=(l=y[u]).topics&&1<l.topics.length)for(h=l.topics.map(function(t){return B.topic_ids[t]}).sort(),W=1/(l.topics.length-1),r=l.bookmarkers,c=f=0,g=h.length;f<g;c=++f)for(a=h[c],b=0,k=(v=h.slice(c+1)).length;b<k;b++)d=v[b],null==(s=this.topic_connections)[a]&&(s[a]={}),null==(i=this.topic_connections[a])[d]&&(i[d]={count:0,topic_count_score:0,bookmark_score:0,title:"Connecting Metrics:"}),0===this.topic_connections[a][d].count&&(this.topic_connection_count+=1),this.topic_connections[a][d].count+=1,this.topic_connections[a][d].topic_count_score+=W,this.topic_connections[a][d].bookmark_score+=r,this.topic_connections[a][d].title+="<br>"+l.name}return t.prototype.showEdge=function(t){return this.options.edge_formula===o.simple?t.count>=this.options.edge_threshold:this.options.edge_formula===o.topic_count?t.topic_count_score>=this.options.edge_threshold:t.bookmark_score>=this.options.edge_threshold},t.prototype.showNode=function(t){var o;if(this.options.node_formula===e.bookmarks){if(t.bookmarkers<this.options.node_threshold)return!1}else if(t.metrics<this.options.node_threshold)return!1;return!(0<this.options.topic_frameworks.length&&(o=t.framework,n.call(this.options.topic_frameworks,o)<0))},t.prototype.setFontSize=function(t){var o,e;return this.options.font_size=t,null==(o=this.vis_config).nodes&&(o.nodes={}),null==(e=this.vis_config.nodes).font&&(e.font={}),this.vis_config.nodes.font.size=t},t.prototype.updateEdges=function(){var o,e,n,s,t,i;for(e in this.edges=new vis.DataSet([]),i=[],t=this.topic_connections)s=t[e],i.push(function(){var t;for(n in t=[],s)o=s[n],this.showEdge(this.topic_connections[e][n])?t.push(this.edges.add({from:parseInt(e),to:parseInt(n),value:o.count*this.options.edge_size,metrics:o.title})):t.push(void 0);return t}.call(this));return i},t.prototype.updateNodes=function(){var t,o,e,n,s,i,r,c;for(this.nodes=new vis.DataSet([]),i=[],e=0,n=(s=this.topics).length;e<n;e++)r=s[e],this.showNode(r)?(t=this.family_colors[r.family],o=function(){switch(!1){case!this.options.colorful:return r.id;case!t:return t;default:return 1}}.call(this),c=this.options.node_formula_bookmark?r.bookmarkers:r.metrics,i.push(this.nodes.add({id:r.id,label:r.title,label_bak:r.framework+": "+r.name,value:c*this.options.node_size,group:o}))):i.push(void 0);return i},t.prototype.loadConfig=function(t){return this.options=t,this.setFontSize(t.font_size)},t.prototype.getVisConfig=function(){return jsyaml.safeDump(this.vis_config)},t.prototype.setVisConfig=function(t){return this.vis_config=jsyaml.safeLoad(t),this.network.setOptions(this.vis_config)},t.prototype.showLabelsFor=function(e){return this.nodes.update(this.nodes.get({fields:["id","label_bak"]}).map(function(t){var o;return{id:t.id,label:(o=t.id,0<=n.call(e,o)?t.label_bak:"")}}))},t.prototype.selectNode=function(t,o){var e;return this.selected_node=t,e=this.network.getConnectedNodes(this.selected_node),this.showLabelsFor(e),this.edges.update(this.edges.getIds().map(function(t){return{id:t,hidden:n.call(o,t)<0}}))},t.prototype.selectEdge=function(t){return $("#mymodal .modal-body > p").html(t.metrics),$("#mymodal").show()},t.prototype.reset=function(){return this.selected_node=null,this.nodes.update(this.nodes.get({fields:["id","label_bak"]}).map(function(t){return{id:t.id,label:t.label_bak}})),this.edges.update(this.edges.getIds().map(function(t){return{id:t,hidden:!1}}))},t.prototype.render=function(){var c;return this.data={nodes:this.nodes,edges:this.edges},this.network=new vis.Network(this.container,this.data,this.vis_config),(c=this).network.on("hoverNode",function(t){var o;return(o=c.nodes.get(t.node)).label=o.label_bak,c.nodes.update(o),o}),this.network.on("doubleClick",function(t){var o,e,n,s,i,r;for(r=t.nodes[0],o=[],n=0,s=(e=c.network.getConnectedNodes(r)).length;n<s;n++)i=e[n],o=o.concat(c.network.getConnectedNodes(i));return c.showLabelsFor(o)}),this.network.on("click",function(t){return 0<t.nodes.length?this.selected_node===t.nodes[0]?c.reset():c.selectNode(t.nodes[0],t.edges):0<t.edges.length?c.selectEdge(c.edges.get(t.edges[0])):c.reset()})},t}()}).call(this);